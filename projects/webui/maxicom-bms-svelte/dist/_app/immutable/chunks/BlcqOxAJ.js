import{w as p}from"./dWGBaOqy.js";import{s as e}from"./BDygqj0r.js";const u="/rest",i="/rest/latest-value",f=sessionStorage.getItem("session-active")==="true",l=p(f);async function v(o,a){try{const s=new URLSearchParams({accountID:"1"}),n=await fetch(`${i}/account?${s}`);if(!n.ok)throw new Error("Network response was not ok");const r=await n.json();if(r?.success&&r.data){const c=r.data.username,t=r.data.password;return o===c&&a===t?(d(),!0):(e("Incorrect username or password.","error"),!1)}return e("Invalid response from authentication server.","error"),!1}catch(s){return console.error("Error during login (latest-value API):",s),w(o,a)}}async function w(o,a){try{const[s,n]=await Promise.all([fetch(`${u}/channels/account_1_username`).then(t=>t.json()),fetch(`${u}/channels/account_1_password`).then(t=>t.json())]),r=s.record.value,c=n.record.value;return o===r&&a===c?(d(),!0):(e("Incorrect username or password.","error"),!1)}catch(s){return console.error("Error during login (fallback):",s),e("Could not connect to authentication server.","error"),!1}}function I(){sessionStorage.removeItem("session-active"),l.set(!1)}async function P(o,a){try{const s=new URLSearchParams({accountID:"1"}),r=await(await fetch(`${i}/account?${s}`)).json();if(!r?.success||!r.data)return e("Could not verify old password.","error"),!1;const c=r.data.password;if(o!==c)return e("Incorrect old password.","error"),!1;const t={id:"account_1_password",valueType:"STRING",record:{timestamp:Date.now(),flag:"VALID",value:a}};if((await fetch(`${u}/channels/account_1_password/latestRecord`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)return e("Password changed successfully.","success"),!0;throw new Error("Put failed")}catch(s){return console.error("Error changing password",s),h(o,a)}}async function h(o,a){try{const n=(await fetch(`${u}/channels/account_1_password`).then(t=>t.json())).record.value;if(o!==n)return e("Incorrect old password.","error"),!1;const r={record:{flag:"VALID",value:a}};if((await fetch(`${u}/channels/account_1_password`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)return e("Password changed successfully.","success"),!0;throw new Error("Fallback put failed")}catch(s){return console.error("Error changing password fallback",s),e("Error saving new password.","error"),!1}}function d(){sessionStorage.setItem("session-active","true"),l.set(!0)}export{I as a,P as c,l as i,v as l};
