import{f as g,a as _}from"../chunks/BvcnRxV3.js";import{i as Vt}from"../chunks/DR0U67OU.js";import{o as Mt,a as Ot}from"../chunks/Cb1jsLsh.js";import{p as Ht,t as A,a as Pt,s as r,c as n,d as i,m as N,g as t,r as a,n as Ut,f as et,D as jt}from"../chunks/BF58R_c0.js";import{s as d}from"../chunks/B_YZgT57.js";import{i as at}from"../chunks/-VyRmxmc.js";import{e as rt}from"../chunks/CV7ClYhq.js";import{r as Rt}from"../chunks/Cgh8k5fy.js";import{s as x,c as E}from"../chunks/BxPf8j-7.js";import{e as C}from"../chunks/in_xl-lZ.js";import{b as Jt}from"../chunks/CGPT4jpp.js";import{s as qt,a as Bt}from"../chunks/BJYXm7hM.js";import{g as Ft}from"../chunks/Cxo7fL4D.js";import{s as Gt}from"../chunks/Cm26uidq.js";import{s as $}from"../chunks/BDygqj0r.js";const Kt="/rest",Wt="/rest/latest-value",Qt="site_name_1",G="My Monitoring Site";async function lt(u){const y=await u.text();try{return y?JSON.parse(y):null}catch{return null}}async function nt(){try{const u=await fetch(`${Wt}/site-name`,{method:"GET",headers:{Accept:"application/json"}}),y=await lt(u);return console.log("[Site] Latest-value API response:",y),u.ok?y?.success&&typeof y.data=="string"&&y.data.trim().length>0?y.data:(console.warn("[Site] Unexpected latest-value response, falling back to default:",y),G):(console.warn("[Site] HTTP error when loading site name:",u.status,y),G)}catch(u){return console.error("[Site] Could not load site name from latest-value, using default.",u),G}}async function Xt(u){const y={record:{flag:"VALID",value:u}};console.log("[Site] Saving site name:",u);const h=await fetch(`${Kt}/channels/${Qt}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(y)}),p=await lt(h);if(!h.ok)throw console.error("[Site] Error saving site name:",h.status,p),new Error(p&&(p.message||p.error)||`Error saving site name (HTTP ${h.status})`);return console.log("[Site] Site name saved successfully:",p),p}var Yt=g('<span class="home-icon svelte-1tyszyy">ğŸ </span> <h1 class="svelte-1tyszyy"> </h1> <button class="icon-btn svelte-1tyszyy">âœï¸</button>',1),Zt=g('<input/> <button class="icon-btn ok svelte-1tyszyy">âœ”</button> <button class="icon-btn svelte-1tyszyy">âœ–</button>',1),ts=g('<div class="summary-pill svelte-1tyszyy"><div class="pill-left svelte-1tyszyy"><span>ğŸ”‹</span> <strong> </strong> <span> </span></div> <span> </span></div>'),ss=g('<div class="empty-card svelte-1tyszyy"><strong>No battery strings configured.</strong> <div class="muted svelte-1tyszyy">Please configure strings in Settings.</div></div>'),es=g('<tr class="table-row svelte-1tyszyy"><td class="link svelte-1tyszyy"> </td><td class="svelte-1tyszyy"><span></span> </td><td class="svelte-1tyszyy"><span></span> </td><td class="svelte-1tyszyy"><span></span> </td><td class="svelte-1tyszyy"><span></span> </td><td class="svelte-1tyszyy"><span></span> </td><td class="svelte-1tyszyy"> </td><td class="svelte-1tyszyy"> </td><td class="svelte-1tyszyy"> </td></tr>'),as=g('<div class="table-card svelte-1tyszyy"><table class="svelte-1tyszyy"><thead class="svelte-1tyszyy"><tr><th class="svelte-1tyszyy">String Name</th><th class="svelte-1tyszyy">Cell Vol</th><th class="svelte-1tyszyy">Cell Rst</th><th class="svelte-1tyszyy">String Vol</th><th class="svelte-1tyszyy">Current</th><th class="svelte-1tyszyy">Ambient</th><th class="svelte-1tyszyy">SoC (%)</th><th class="svelte-1tyszyy">SoH (%)</th><th class="svelte-1tyszyy">Last Update</th></tr></thead><tbody class="svelte-1tyszyy"></tbody></table></div>'),rs=g('<div class="page-container svelte-1tyszyy"><div class="site-header svelte-1tyszyy"><div class="site-left svelte-1tyszyy"><!></div> <div class="string-summary svelte-1tyszyy"></div></div> <div class="thermal-section svelte-1tyszyy"><div class="thermal-header svelte-1tyszyy"><h3 class="svelte-1tyszyy">ğŸŒ¡ Thermal Camera</h3> <button class="icon-btn svelte-1tyszyy"> </button></div> <div class="no-thermal svelte-1tyszyy">â„¹ No thermal data available</div></div> <!></div>');function bs(u,y){Ht(y,!1);const h=()=>Bt(Gt,"$stringsState",p),[p,ot]=qt();let b=N("My Monitoring Site"),f=N(""),k=N(!1),w=N(!1);function it(){i(f,t(b)),i(k,!0)}async function yt(){const s=t(f).trim();if(!s){$("Site name cannot be empty.","error");return}i(w,!0);try{await Xt(s);try{const e=await nt();i(b,e),i(f,e),$("Site name updated.","success")}catch{i(b,s),i(f,s),$("Site name updated (but could not verify).","info")}i(k,!1)}catch(e){console.error("[Site] Save failed:",e),$("Error saving site name.","error")}finally{i(w,!1)}}function vt(){i(f,t(b)),i(k,!1)}let I=N(!1);function ct(){i(I,!t(I))}let L=N([]),K=null;Mt(async()=>{i(b,await nt()),K=Ft().subscribe(s=>{i(L,s.map(e=>{const o=parseInt(e.id.replace("str",""),10),v=h().find(c=>c.stringIndex===o);return{...e,stringName:v?.stringName||e.stringName}}))})}),Ot(()=>{K?.unsubscribe()});function T(s){return s==="On"?"status on":"status off"}function dt(s){try{const e=s instanceof Date?s:new Date(s);return isNaN(e.getTime())?"N/A":e.toLocaleString()}catch{return"N/A"}}function ut(s){window.location.href=`/setting/string/${s}`}Vt();var V=rs(),M=n(V),O=n(M),pt=n(O);{var ft=s=>{var e=Yt(),o=r(et(e),2),v=n(o,!0);a(o);var c=r(o,2);A(()=>d(v,t(b))),C("click",c,it),_(s,e)},mt=s=>{var e=Zt(),o=et(e);Rt(o);var v=r(o,2),c=r(v,2);A(()=>{o.disabled=t(w),v.disabled=t(w),c.disabled=t(w)}),Jt(o,()=>t(f),l=>i(f,l)),C("click",v,yt),C("click",c,vt),_(s,e)};at(pt,s=>{t(k)?s(mt,!1):s(ft)})}a(O);var W=r(O,2);rt(W,5,()=>t(L),s=>s.id,(s,e)=>{const o=jt(()=>(t(e).soH??100)<80);var v=ts(),c=n(v),l=r(n(c),2),z=n(l,!0);a(l);var S=r(l,2),U=n(S);a(S),a(c);var m=r(c,2),D=n(m,!0);a(m),a(v),A(()=>{d(z,t(e).stringName),d(U,`${t(e).totalCells??110??""} cells`),x(m,1,"pill-pin "+(t(o)?"low":"ok"),"svelte-1tyszyy"),d(D,t(o)?"LOW":"OK")}),_(s,v)}),a(W),a(M);var H=r(M,2),Q=n(H),P=r(n(Q),2),_t=n(P);a(P),a(Q),Ut(2),a(H);var gt=r(H,2);{var ht=s=>{var e=ss();_(s,e)},bt=s=>{var e=as(),o=n(e),v=r(n(o));rt(v,5,()=>t(L),c=>c.id,(c,l)=>{var z=es(),S=n(z),U=n(S,!0);a(S);var m=r(S),D=n(m),zt=r(D,1,!0);a(m);var j=r(m),X=n(j),St=r(X,1,!0);a(j);var R=r(j),Y=n(R),Nt=r(Y,1,!0);a(R);var J=r(R),Z=n(J),xt=r(Z,1,!0);a(J);var q=r(J),tt=n(q),wt=r(tt,1,!0);a(q);var B=r(q),Tt=n(B,!0);a(B);var F=r(B),At=n(F,!0);a(F);var st=r(F),Et=n(st,!0);a(st),a(z),A((Ct,kt,Lt,Dt,$t,It)=>{d(U,t(l).stringName),x(D,1,Ct,"svelte-1tyszyy"),d(zt,t(l).cellVol),x(X,1,kt,"svelte-1tyszyy"),d(St,t(l).cellRst),x(Y,1,Lt,"svelte-1tyszyy"),d(Nt,t(l).stringVol),x(Z,1,Dt,"svelte-1tyszyy"),d(xt,t(l).current),x(tt,1,$t,"svelte-1tyszyy"),d(wt,t(l).ambient),d(Tt,t(l).soC??"N/A"),d(At,t(l).soH??"N/A"),d(Et,It)},[()=>E(T(t(l).cellVol)),()=>E(T(t(l).cellRst)),()=>E(T(t(l).stringVol)),()=>E(T(t(l).current)),()=>E(T(t(l).ambient)),()=>dt(t(l).updateTime)]),C("click",z,()=>ut(t(l).id)),_(c,z)}),a(v),a(o),a(e),_(s,e)};at(gt,s=>{t(L).length===0?s(ht):s(bt,!1)})}a(V),A(()=>d(_t,`ğŸ“· ${t(I)?"On":"Off"}`)),C("click",P,ct),_(u,V),Pt(),ot()}export{bs as component};
