import{c as Se,a as _,f as $}from"../chunks/BvcnRxV3.js";import{c as Ie,o as Me}from"../chunks/Cb1jsLsh.js";import{p as Ce,aD as Qe,aE as Be,f as Ve,a as xe,az as me,d,m as ye,c as a,r as t,s as l,t as X,g as e,i as Ae,u as ce,aF as y,at as ge}from"../chunks/BF58R_c0.js";import{s as w}from"../chunks/B_YZgT57.js";import{i as ue}from"../chunks/-VyRmxmc.js";import{e as Pe,i as Ee}from"../chunks/CV7ClYhq.js";import{d as ke}from"../chunks/in_xl-lZ.js";import{s as we,a as fe}from"../chunks/BJYXm7hM.js";import{l as De,u as Oe,a as Le,s as ze,d as Re}from"../chunks/Cm26uidq.js";import{c as $e}from"../chunks/BHmcWbX2.js";import{g as Te}from"../chunks/If0Ce8cq.js";import{i as je}from"../chunks/DR0U67OU.js";import{r as P}from"../chunks/Cgh8k5fy.js";import{b as k}from"../chunks/CGPT4jpp.js";import{b as qe}from"../chunks/B-TPmVdp.js";import{p as he}from"../chunks/CGZ8RBSl.js";import{s as A}from"../chunks/BDygqj0r.js";var Ge=$("<option> </option>"),He=$('<div class="modal-backdrop svelte-868991" role="button" tabindex="0"><div class="modal-content svelte-868991" role="document" tabindex="0"><div class="modal-header svelte-868991"><h2 class="svelte-868991"> </h2> <button class="close-button svelte-868991"><i class="bi bi-x-lg"></i></button></div> <div class="modal-body svelte-868991"><div class="form-group svelte-868991"><label for="stringName" class="svelte-868991">String Name</label> <input type="text" id="stringName" placeholder="e.g. String 1" class="svelte-868991"/></div> <div class="form-row svelte-868991"><div class="form-group svelte-868991"><label for="cellQty" class="svelte-868991">Cell Qty</label> <input type="number" id="cellQty" min="1" class="svelte-868991"/></div> <div class="form-group svelte-868991"><label for="cellBrand" class="svelte-868991">Cell Brand</label> <input type="text" id="cellBrand" class="svelte-868991"/></div></div> <div class="form-row svelte-868991"><div class="form-group svelte-868991"><label for="cellModel" class="svelte-868991">Cell Model</label> <input type="text" id="cellModel" class="svelte-868991"/></div> <div class="form-group svelte-868991"><label for="ratedCapacity" class="svelte-868991">Rated Capacity (Ah)</label> <input type="number" id="ratedCapacity" step="0.1" class="svelte-868991"/></div></div> <div class="form-row svelte-868991"><div class="form-group svelte-868991"><label for="cutoffVoltage" class="svelte-868991">Cutoff Voltage (V)</label> <input type="number" id="cutoffVoltage" step="0.01" class="svelte-868991"/></div> <div class="form-group svelte-868991"><label for="floatVoltage" class="svelte-868991">Float Voltage (V)</label> <input type="number" id="floatVoltage" step="0.01" class="svelte-868991"/></div></div> <div class="form-row svelte-868991"><div class="form-group svelte-868991"><label for="serialPort" class="svelte-868991">Serial Port</label> <select id="serialPort" class="svelte-868991"></select></div></div></div> <div class="modal-footer svelte-868991"><button class="btn-secondary svelte-868991">Cancel</button> <button class="btn-primary svelte-868991">Save</button></div></div></div>');function Je(oe,E){Ce(E,!1);const h=()=>fe($e,"$configuredPorts",N),[N,Y]=we();let n=he(E,"stringConfig",8,null),c=he(E,"isOpen",8,!1);const F=Ie();let s=ye({stringName:"",cellBrand:"",cellModel:"",cellQty:0,ratedCapacity:0,cutoffVoltage:0,floatVoltage:0,serialPortId:""}),D=ye(!1);function de(){d(s,{stringName:"",cellBrand:"",cellModel:"",cellQty:0,ratedCapacity:0,cutoffVoltage:0,floatVoltage:0,serialPortId:h().length>0?h()[0].id:""})}function m(){F("cancel")}function Z(){F("save",{...e(s)})}Qe(()=>(me(c()),me(n())),()=>{c()&&(n()?(d(D,!0),d(s,{stringName:n().stringName,cellBrand:n().cellBrand,cellModel:n().cellModel,cellQty:n().cellQty,ratedCapacity:n().ratedCapacity,cutoffVoltage:n().cutoffVoltage,floatVoltage:n().floatVoltage,serialPortId:n().serialPortId})):(d(D,!1),de()))}),Be(),je();var ee=Se(),ve=Ve(ee);{var O=S=>{var p=He();p.__click=m,p.__keydown=r=>r.key==="Escape"&&m();var I=a(p);I.__click=r=>r.stopPropagation(),I.__keydown=r=>r.key==="Escape"&&m();var M=a(I),L=a(M),te=a(L,!0);t(L);var ne=l(L,2);ne.__click=m,t(M);var z=l(M,2),R=a(z),i=l(a(R),2);P(i),t(R);var o=l(R,2),v=a(o),g=l(a(v),2);P(g),t(v);var T=l(v,2),ae=l(a(T),2);P(ae),t(T),t(o);var j=l(o,2),q=a(j),G=l(a(q),2);P(G),t(q);var H=l(q,2),J=l(a(H),2);P(J),t(H),t(j);var K=l(j,2),f=a(K),C=l(a(f),2);P(C),t(f);var se=l(f,2),Q=l(a(se),2);P(Q),t(se),t(K);var b=l(K,2),le=a(b),V=l(a(le),2);X(()=>{e(s),Ae(()=>{h()})}),Pe(V,5,h,Ee,(r,u)=>{var x=Ge(),W=a(x,!0);t(x);var ie={};X(()=>{w(W,(e(u),ce(()=>e(u).alias||e(u).id))),ie!==(ie=(e(u),ce(()=>e(u).id)))&&(x.value=(x.__value=(e(u),ce(()=>e(u).id)))??"")}),_(r,x)}),t(V),t(le),t(b),t(z);var B=l(z,2),re=a(B);re.__click=m;var U=l(re,2);U.__click=Z,t(B),t(I),t(p),X(()=>w(te,e(D)?"Edit String":"Add String")),k(i,()=>e(s).stringName,r=>y(s,e(s).stringName=r)),k(g,()=>e(s).cellQty,r=>y(s,e(s).cellQty=r)),k(ae,()=>e(s).cellBrand,r=>y(s,e(s).cellBrand=r)),k(G,()=>e(s).cellModel,r=>y(s,e(s).cellModel=r)),k(J,()=>e(s).ratedCapacity,r=>y(s,e(s).ratedCapacity=r)),k(C,()=>e(s).cutoffVoltage,r=>y(s,e(s).cutoffVoltage=r)),k(Q,()=>e(s).floatVoltage,r=>y(s,e(s).floatVoltage=r)),qe(V,()=>e(s).serialPortId,r=>y(s,e(s).serialPortId=r)),_(S,p)};ue(ve,S=>{c()&&S(O)})}_(oe,ee),xe(),Y()}ke(["click","keydown"]);var Ke=$('<div class="loading-spinner svelte-vg6ddb"><div class="spinner svelte-vg6ddb"></div> <p>Loading data...</p></div>'),Ue=$('<tr class="no-data-row svelte-vg6ddb"><td colspan="5" class="svelte-vg6ddb">No Strings have been configured yet.</td></tr>'),We=$('<tr class="svelte-vg6ddb"><td class="svelte-vg6ddb"> </td><td class="svelte-vg6ddb"> </td><td class="svelte-vg6ddb"> </td><td class="svelte-vg6ddb"> </td><td class="actions-cell svelte-vg6ddb"><button class="icon-button primary svelte-vg6ddb" title="View"><i class="bi bi-eye svelte-vg6ddb"></i></button> <button class="icon-button svelte-vg6ddb" title="Edit"><i class="bi bi-pencil svelte-vg6ddb"></i></button> <button class="icon-button warn svelte-vg6ddb" title="Delete"><i class="bi bi-trash svelte-vg6ddb"></i></button></td></tr>'),Xe=$('<div class="table-card svelte-vg6ddb"><div class="table-container svelte-vg6ddb"><table class="mat-table svelte-vg6ddb"><thead class="svelte-vg6ddb"><tr><th class="svelte-vg6ddb">Index</th><th class="svelte-vg6ddb">Name</th><th class="svelte-vg6ddb">Cell Qty</th><th class="svelte-vg6ddb">Serial Port</th><th class="svelte-vg6ddb">Actions</th></tr></thead><tbody class="svelte-vg6ddb"><!></tbody></table></div> <div class="table-footer svelte-vg6ddb"><div class="paginator svelte-vg6ddb"><span class="paginator-label">Items per page: 5</span> <span class="paginator-range"> </span></div></div></div>'),Ye=$('<div class="string-list-container svelte-vg6ddb"><div class="page-header svelte-vg6ddb"><div class="header-content svelte-vg6ddb"><h1 class="page-title svelte-vg6ddb"><i class="bi bi-battery-charging-full title-icon svelte-vg6ddb"></i> String Configuration</h1> <p class="page-subtitle svelte-vg6ddb"></p></div> <div class="header-actions"><button class="btn-primary svelte-vg6ddb"><i class="bi bi-plus-lg"></i> Add String</button></div></div> <!> <!></div>');function pt(oe,E){Ce(E,!0);const h=()=>fe($e,"$configuredPorts",Y),N=()=>fe(ze,"$stringsState",Y),[Y,n]=we();let c=ge(!0),F=ge(!1),s=ge(null);Me(async()=>{d(c,!0),await De(),d(c,!1)});function D(i){return h().find(v=>v.id===i)?.alias||i||"N/A"}function de(i){Te(`/setting/string/str${i.stringIndex}`)}function m(i){d(s,i||null,!0),d(F,!0)}function Z(){d(F,!1),d(s,null)}async function ee(i){const o=i.detail,v=h().find(g=>g.id===o.serialPortId);if(!v){A("Invalid Serial Port selected","error");return}try{d(c,!0),e(s)?(await Oe(e(s).id,o,v),A("String updated successfully","success")):(await Le(o,v),A("String added successfully","success")),Z()}catch(g){console.error("Failed to save string",g),A(g instanceof Error?g.message:"Failed to save string","error")}finally{d(c,!1)}}async function ve(i){if(confirm(`Are you sure you want to delete ${i.stringName}?`))try{d(c,!0),await Re(i.id),A("String deleted successfully","success")}catch(o){console.error("Failed to delete string",o),A("Failed to delete string","error")}finally{d(c,!1)}}var O=Ye(),S=a(O),p=a(S),I=l(a(p),2);I.textContent="Manage Strings at site: Site",t(p);var M=l(p,2),L=a(M);L.__click=()=>m(),t(M),t(S);var te=l(S,2);{var ne=i=>{var o=Ke();_(i,o)},z=i=>{var o=Xe(),v=a(o),g=a(v),T=l(a(g)),ae=a(T);{var j=f=>{var C=Ue();_(f,C)},q=f=>{var C=Se(),se=Ve(C);Pe(se,3,N,Q=>Q.id,(Q,b,le)=>{var V=We(),B=a(V),re=a(B,!0);t(B);var U=l(B),r=a(U,!0);t(U);var u=l(U),x=a(u,!0);t(u);var W=l(u),ie=a(W,!0);t(W);var be=l(W),pe=a(be);pe.__click=()=>de(e(b));var _e=l(pe,2);_e.__click=()=>m(e(b));var Ne=l(_e,2);Ne.__click=()=>ve(e(b)),t(be),t(V),X(Fe=>{w(re,e(b).stringIndex||e(le)+1),w(r,e(b).stringName),w(x,e(b).cellQty),w(ie,Fe)},[()=>D(e(b).serialPortId)]),_(Q,V)}),_(f,C)};ue(ae,f=>{N().length===0?f(j):f(q,!1)})}t(T),t(g),t(v);var G=l(v,2),H=a(G),J=l(a(H),2),K=a(J);t(J),t(H),t(G),t(o),X(()=>w(K,`1 - ${N().length??""} of ${N().length??""}`)),_(i,o)};ue(te,i=>{e(c)?i(ne):i(z,!1)})}var R=l(te,2);Je(R,{get isOpen(){return e(F)},get stringConfig(){return e(s)},$$events:{cancel:Z,save:ee}}),t(O),_(oe,O),xe(),n()}ke(["click"]);export{pt as component};
