import{c as jt,a as f,f as x}from"../chunks/BvcnRxV3.js";import{c as Dt,o as Ct}from"../chunks/Cb1jsLsh.js";import{p as It,aD as Yt,aE as Nt,f as kt,a as Tt,d as j,m as Rt,az as Bt,c as a,r as e,s as r,g as t,t as g,i as mt,u as G,aF as rt,at as lt,aB as Et}from"../chunks/BF58R_c0.js";import{s as b}from"../chunks/B_YZgT57.js";import{i as $}from"../chunks/-VyRmxmc.js";import{e as ot,i as pt}from"../chunks/CV7ClYhq.js";import{d as At}from"../chunks/in_xl-lZ.js";import{s as Ft,a as Mt}from"../chunks/BJYXm7hM.js";import{a as Ut,b as Lt,u as zt,d as Kt,e as Vt,f as qt,c as Gt}from"../chunks/BHmcWbX2.js";import{i as Ot}from"../chunks/DR0U67OU.js";import{a as Ht}from"../chunks/Cgh8k5fy.js";import{b as gt}from"../chunks/B-TPmVdp.js";import{p as B}from"../chunks/CGZ8RBSl.js";import{s as wt}from"../chunks/BxPf8j-7.js";const Jt=[9600,19200,38400,57600,115200],Qt=[5,6,7,8],Wt=[1,1.5,2],Xt=["PARITY_NONE","PARITY_EVEN","PARITY_ODD","PARITY_MARK","PARITY_SPACE"];var Zt=x("<option> </option>"),$t=x('<div class="port-info svelte-1mi3kf6"><small> </small></div>'),te=x('<div class="form-group svelte-1mi3kf6"><label for="portSelect" class="svelte-1mi3kf6">Serial Port</label> <select id="portSelect" class="svelte-1mi3kf6"><option>-- Select a port --</option><!></select> <!></div>'),ee=x("<option> </option>"),ae=x("<option> </option>"),se=x("<option> </option>"),ie=x("<option> </option>"),re=x('<div class="modal-backdrop svelte-1mi3kf6" role="button" tabindex="0"><div class="modal-content svelte-1mi3kf6" role="document" tabindex="0"><div class="modal-header svelte-1mi3kf6"><h2 class="svelte-1mi3kf6"> </h2> <button class="close-button svelte-1mi3kf6"><i class="bi bi-x-lg"></i></button></div> <div class="modal-body svelte-1mi3kf6"><!> <div class="form-row svelte-1mi3kf6"><div class="form-group svelte-1mi3kf6"><label for="baudRate" class="svelte-1mi3kf6">Baud Rate</label> <select id="baudRate" class="svelte-1mi3kf6"></select></div> <div class="form-group svelte-1mi3kf6"><label for="dataBits" class="svelte-1mi3kf6">Data Bits</label> <select id="dataBits" class="svelte-1mi3kf6"></select></div></div> <div class="form-row svelte-1mi3kf6"><div class="form-group svelte-1mi3kf6"><label for="parity" class="svelte-1mi3kf6">Parity</label> <select id="parity" class="svelte-1mi3kf6"></select></div> <div class="form-group svelte-1mi3kf6"><label for="stopBits" class="svelte-1mi3kf6">Stop Bits</label> <select id="stopBits" class="svelte-1mi3kf6"></select></div></div></div> <div class="modal-footer svelte-1mi3kf6"><button class="btn-secondary svelte-1mi3kf6">Cancel</button> <button class="btn-primary svelte-1mi3kf6">Save</button></div></div></div>');function le(vt,d){It(d,!1);let S=B(d,"isOpen",8,!1),R=B(d,"portToEdit",8,null),tt=B(d,"baudRates",24,()=>[]),E=B(d,"dataBits",24,()=>[]),F=B(d,"stopBits",24,()=>[]),H=B(d,"parityOptions",24,()=>[]),m=B(d,"availablePorts",24,()=>[]),I=B(d,"configuredPortIds",24,()=>[]);const D=Dt();let i=Rt({baudRate:9600,dataBits:8,parity:"PARITY_NONE",stopBits:1,portId:""}),O=Rt(!1),k=Rt(null);function M(){const p=m().find(u=>!I().includes(u.id));j(i,{baudRate:9600,dataBits:8,parity:"PARITY_NONE",stopBits:1,portId:p?.id||""}),j(k,p||null)}function y(){D("cancel")}function U(){if(!t(i).portId&&!t(O)){alert("Please select a port");return}D("save",{...t(i)})}function C(p){const u=p.target;rt(i,t(i).portId=u.value),j(k,m().find(T=>T.id===u.value))}Yt(()=>(Bt(S()),Bt(R()),Bt(m())),()=>{S()&&(R()?(j(O,!0),j(i,{baudRate:R().baudRate,dataBits:R().dataBits,parity:R().parity,stopBits:R().stopBits,portId:R().id}),j(k,m().find(p=>p.id===R().id))):(j(O,!1),M()))}),Nt(),Ot();var J=jt(),L=kt(J);{var Q=p=>{var u=re();u.__click=y,u.__keydown=l=>l.key==="Escape"&&y();var T=a(u);T.__click=l=>l.stopPropagation(),T.__keydown=l=>l.key==="Escape"&&y();var W=a(T),z=a(W),K=a(z,!0);e(z);var et=r(z,2);et.__click=y,e(W);var w=r(W,2),v=a(w);{var c=l=>{var o=te(),s=r(a(o),2);g(()=>{t(i),mt(()=>{m(),I()})}),s.__change=C;var h=a(s);h.value=h.__value="";var P=r(h);ot(P,1,m,pt,(A,_)=>{var N=jt(),ut=kt(N);{var _t=bt=>{var q=Zt(),St=a(q);e(q);var yt={};g(()=>{b(St,`${t(_),G(()=>t(_).alias)??""} (${t(_),G(()=>t(_).devicePath)??""})`),yt!==(yt=(t(_),G(()=>t(_).id)))&&(q.value=(q.__value=(t(_),G(()=>t(_).id)))??"")}),f(bt,q)};$(ut,bt=>{Bt(I()),t(_),t(i),G(()=>!I().includes(t(_).id)||t(_).id===t(i).portId)&&bt(_t)})}f(A,N)}),e(s);var Z=r(s,2);{var ft=A=>{var _=$t(),N=a(_),ut=a(N);e(N),e(_),g(()=>b(ut,`Device Path: ${t(k),G(()=>t(k).devicePath)??""}`)),f(A,_)};$(Z,A=>{t(k)&&A(ft)})}e(o),gt(s,()=>t(i).portId,A=>rt(i,t(i).portId=A)),f(l,o)};$(v,l=>{t(O)||l(c)})}var n=r(v,2),V=a(n),at=r(a(V),2);g(()=>{t(i),mt(()=>{tt()})}),ot(at,5,tt,pt,(l,o)=>{var s=ee(),h=a(s,!0);e(s);var P={};g(()=>{b(h,t(o)),P!==(P=t(o))&&(s.value=(s.__value=t(o))??"")}),f(l,s)}),e(at),e(V);var ht=r(V,2),nt=r(a(ht),2);g(()=>{t(i),mt(()=>{E()})}),ot(nt,5,E,pt,(l,o)=>{var s=ae(),h=a(s,!0);e(s);var P={};g(()=>{b(h,t(o)),P!==(P=t(o))&&(s.value=(s.__value=t(o))??"")}),f(l,s)}),e(nt),e(ht),e(n);var Pt=r(n,2),st=a(Pt),it=r(a(st),2);g(()=>{t(i),mt(()=>{H()})}),ot(it,5,H,pt,(l,o)=>{var s=se(),h=a(s,!0);e(s);var P={};g((Z,ft)=>{Ht(s,"label",Z),b(h,ft),P!==(P=t(o))&&(s.value=(s.__value=t(o))??"")},[()=>(t(o),G(()=>t(o).replace("PARITY_",""))),()=>(t(o),G(()=>t(o).replace("PARITY_","")))]),f(l,s)}),e(it),e(st);var dt=r(st,2),ct=r(a(dt),2);g(()=>{t(i),mt(()=>{F()})}),ot(ct,5,F,pt,(l,o)=>{var s=ie(),h=a(s,!0);e(s);var P={};g(()=>{b(h,t(o)),P!==(P=t(o))&&(s.value=(s.__value=t(o))??"")}),f(l,s)}),e(ct),e(dt),e(Pt),e(w);var Y=r(w,2),X=a(Y);X.__click=y;var xt=r(X,2);xt.__click=U,e(Y),e(T),e(u),g(()=>b(K,t(O)?"Edit Serial Port":"Add Serial Port")),gt(at,()=>t(i).baudRate,l=>rt(i,t(i).baudRate=l)),gt(nt,()=>t(i).dataBits,l=>rt(i,t(i).dataBits=l)),gt(it,()=>t(i).parity,l=>rt(i,t(i).parity=l)),gt(ct,()=>t(i).stopBits,l=>rt(i,t(i).stopBits=l)),f(p,u)};$(L,p=>{S()&&p(Q)})}f(vt,J),Tt()}At(["click","keydown","change"]);var oe=x('<div class="modal-backdrop svelte-1yu3f53" role="button" tabindex="0"><div class="modal-content svelte-1yu3f53" role="document" tabindex="0"><div><h2 class="svelte-1yu3f53"> </h2> <button class="close-button svelte-1yu3f53"><i class="bi bi-x-lg"></i></button></div> <div class="modal-body svelte-1yu3f53"><p class="svelte-1yu3f53"> </p></div> <div class="modal-footer svelte-1yu3f53"><button class="btn-secondary svelte-1yu3f53"> </button> <button> </button></div></div></div>');function ve(vt,d){It(d,!1);let S=B(d,"isOpen",8,!1),R=B(d,"title",8,"Confirm"),tt=B(d,"message",8,""),E=B(d,"type",8,"info"),F=B(d,"confirmText",8,"Confirm"),H=B(d,"cancelText",8,"Cancel");const m=Dt();function I(){m("cancel")}function D(){m("confirm")}Ot();var i=jt(),O=kt(i);{var k=M=>{var y=oe();y.__click=I,y.__keydown=n=>n.key==="Escape"&&I();var U=a(y);U.__click=n=>n.stopPropagation(),U.__keydown=n=>n.key==="Escape"&&I();var C=a(U);let J;var L=a(C),Q=a(L,!0);e(L);var p=r(L,2);p.__click=I,e(C);var u=r(C,2),T=a(u),W=a(T,!0);e(T),e(u);var z=r(u,2),K=a(z);K.__click=I;var et=a(K,!0);e(K);var w=r(K,2);let v;w.__click=D;var c=a(w,!0);e(w),e(z),e(U),e(y),g(()=>{J=wt(C,1,"modal-header svelte-1yu3f53",null,J,{danger:E()==="danger",warning:E()==="warning"}),b(Q,R()),b(W,tt()),b(et,H()),v=wt(w,1,"btn-confirm svelte-1yu3f53",null,v,{danger:E()==="danger",warning:E()==="warning"}),b(c,F())}),f(M,y)};$(O,M=>{S()&&M(k)})}f(vt,i),Tt()}At(["click","keydown"]);var ne=x('<div class="loading-spinner svelte-f5bfjv"><div class="spinner svelte-f5bfjv"></div> <p>Loading Serial port configuration...</p></div>'),de=x('<tr class="no-data-row svelte-f5bfjv"><td colspan="6" class="svelte-f5bfjv">No ports added yet. Click "Add Port" to get started.</td></tr>'),ce=x('<tr class="svelte-f5bfjv"><td class="svelte-f5bfjv"> </td><td class="svelte-f5bfjv"> </td><td class="svelte-f5bfjv"> </td><td class="svelte-f5bfjv"> </td><td class="svelte-f5bfjv"> </td><td class="actions-cell svelte-f5bfjv"><button class="icon-button primary svelte-f5bfjv" title="Edit"><i class="bi bi-pencil svelte-f5bfjv"></i></button></td></tr>'),fe=x('<div class="table-card svelte-f5bfjv"><div class="table-container svelte-f5bfjv"><table class="mat-table svelte-f5bfjv"><thead class="svelte-f5bfjv"><tr><th class="svelte-f5bfjv">Name</th><th class="svelte-f5bfjv">Baud Rate</th><th class="svelte-f5bfjv">Data Bits</th><th class="svelte-f5bfjv">Parity</th><th class="svelte-f5bfjv">Stop Bits</th><th class="svelte-f5bfjv">Actions</th></tr></thead><tbody class="svelte-f5bfjv"><!></tbody></table></div> <div class="table-footer svelte-f5bfjv"><div class="paginator svelte-f5bfjv"><span class="paginator-label">Items per page: 3</span> <span class="paginator-range"> </span></div></div></div>'),ue=x('<div class="serial-container svelte-f5bfjv"><div class="page-header svelte-f5bfjv"><div class="header-content svelte-f5bfjv"><h1 class="page-title svelte-f5bfjv"><i class="bi bi-usb-symbol title-icon svelte-f5bfjv"></i> Serial Configuration</h1> <p class="page-subtitle svelte-f5bfjv">Manage and configure Serial ports (RS-485)</p></div> <div class="header-actions"><button class="btn-primary svelte-f5bfjv"><i class="bi bi-plus-lg"></i> Add Port</button></div></div> <!></div> <!> <!>',1);function Ie(vt,d){It(d,!0);const S=()=>Mt(Gt,"$configuredPorts",R),[R,tt]=Ft();let E=lt(!0),F=lt(!1),H=lt(!1),m=lt(null),I=lt(""),D=lt(null);const i=3;Ct(()=>{const v=Ut().subscribe(n=>{j(E,n,!0)}),c=Lt().subscribe(n=>{},n=>{console.error("Error loading Serial Ports:",n),k("Could not load Serial configuration","error")});return()=>{v?.unsubscribe?.(),c?.unsubscribe?.()}});function O(v){return v?v.replace("PARITY_",""):""}function k(v,c){console.log(`[${c}] ${v}`)}function M(v){j(m,v||null,!0),j(F,!0)}function y(){j(F,!1),j(m,null)}async function U(v){const c=v.detail;try{if(t(m)){const{portId:n,...V}=c;await zt(t(m).id,V),k(`Updated ${t(m).alias}`,"success")}else{const n=await Kt(c);k(`Added ${n.alias}`,"success")}y()}catch(n){k(n.message||"Error while saving port","error")}}function C(){j(H,!1),j(D,null)}async function J(){if(t(D))try{await qt(t(D).id),k(`Deleted ${t(D).alias}`,"info"),C()}catch(v){k(v.message||"Error when deleting port","error")}}var L=ue(),Q=kt(L),p=a(Q),u=r(a(p),2),T=a(u);T.__click=()=>M(),e(u),e(p);var W=r(p,2);{var z=v=>{var c=ne();f(v,c)},K=v=>{var c=fe(),n=a(c),V=a(n),at=r(a(V)),ht=a(at);{var nt=Y=>{var X=de();f(Y,X)},Pt=Y=>{var X=jt(),xt=kt(X);ot(xt,1,S,l=>l.id,(l,o)=>{var s=ce(),h=a(s),P=a(h,!0);e(h);var Z=r(h),ft=a(Z,!0);e(Z);var A=r(Z),_=a(A,!0);e(A);var N=r(A),ut=a(N,!0);e(N);var _t=r(N),bt=a(_t,!0);e(_t);var q=r(_t),St=a(q);St.__click=()=>M(t(o)),e(q),e(s),g(yt=>{b(P,t(o).alias),b(ft,t(o).baudRate),b(_,t(o).dataBits),b(ut,yt),b(bt,t(o).stopBits)},[()=>O(t(o).parity)]),f(l,s)}),f(Y,X)};$(ht,Y=>{S().length===0?Y(nt):Y(Pt,!1)})}e(at),e(V),e(n);var st=r(n,2),it=a(st),dt=r(a(it),2),ct=a(dt);e(dt),e(it),e(st),e(c),g(()=>b(ct,`1 - ${S().length??""} of ${S().length??""}`)),f(v,c)};$(W,v=>{t(E)?v(z):v(K,!1)})}e(Q);var et=r(Q,2);{let v=Et(Vt),c=Et(()=>S().map(n=>n.id));le(et,{get isOpen(){return t(F)},get portToEdit(){return t(m)},get baudRates(){return Jt},get dataBits(){return Qt},get stopBits(){return Wt},get parityOptions(){return Xt},get availablePorts(){return t(v)},get configuredPortIds(){return t(c)},$$events:{save:U,cancel:y}})}var w=r(et,2);ve(w,{get isOpen(){return t(H)},title:"Delete Port",get message(){return t(I)},type:"danger",confirmText:"Delete",cancelText:"Cancel",$$events:{confirm:J,cancel:C}}),g(()=>T.disabled=S().length>=i),f(vt,L),Tt(),tt()}At(["click"]);export{Ie as component};
